\documentclass[11pt]{article}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage[margin=3cm]{geometry}
\usepackage{listings}
\usepackage{ulem}
\usepackage{tikz}

\setlength{\parskip}{1mm}

% \includegraphics [height=50mm] {bild.png}

\setlength{\headheight}{40pt}

\begin{document}
	\title{Microcontroller programming \\
		Automatic dimming of lights using mesh network communication\\
		TE663 Uppsala Universitet VT2015}
	\date{}
	\author{}
	\author{Lars Haulin \texttt{lars.haulin.5967@student.uu.se}\\
		Robin Keller \texttt{robin.keller.4499@student.uu.se}\\
		Viktor Nordmark \texttt{viktor.nordmark.0315@student.uu.se}}
	\maketitle
	
   \abstract{In this project, a control system for lights was created.
   The sensors and dimmers use a mesh network to communicate and keep a constant
   level of illumination, regardless of external disturbances such as a sudden
   cloud blocking external sunlight.}

	\section{Concept}
	
	Our idea is to control lights using dimmers and light sensors.

   The project concept was chosen to make maximal use of our teams experience
   in power electronics, automatic control and network algorithms.

	The sensors and dimmers communicate with radio over a mesh network.
	There is also a possibility to add a user interface over the network to control
	the brightness.
	
	Should the room get brighter or darker from sunlight or other illumination,
	the lights should be adjusted to compensate for this.
	
	\section{Primary goals}

   The primary goals were
	
	\begin{itemize}
		\item To control the brightness of a 230V light bulb with a microcontroller.
		\item To measure the amount of light in a room with a microcontroller.
		\item To communicate data between the microcontrollers over a mesh network.
		\item To make the system capable to compensate for changes in illumination.
		\item To control the system with a user interface node, also containing
		a microcontroller.
	\end{itemize}
	
	\section{Secondary goals}
   Additionally, we put up some secondary goals:
	\begin{itemize}
		\item To have several lamps and sensors
		\item To automate calibration i.e., what lamp affects what sensor
	\end{itemize}

   \section{Hardware design}
   As we had previous experience in our team of the nRF24L01+ radio module from
   Nordic Semiconductor, it was chosen as a base for the mesh network.

   We chose to dim the lights with a triac.
   
   \section{Radio Module nRF24L01+}
   The nRF24L01+ is a radio module which uses the world wide 2.4GHz ISM frequency band. It can operate with an air data rates of 250kbps, 1Mpbs and 2Mbps. To communicate with the radio module the Serial Peripheral Interface used. For every module you can configure a frequency channel and an address. The data which will be sent is shifted to an internal data pipe. With the send-command the data pipe is interpreted as a packet and will send to the previous configured address.
   
   You are able to configure the \textit{Enhanced ShockBurst\texttrademark} which is a special data link layer. It supports automatic packets handling, especially auto acknowledge of packets.
   A communication which uses this auto acknowledge is only working between two nodes which use the same address.
   
   \section{Data Link Layer Library for AVR and RaspberryPi}
   The library for the radio module nRF24L01+ was previous written by Robin Keller and will be reused in this project. Therefore the configuration for the AVR ATmega328 was added to the library.
   The library does not pass the complete functionality of the radio module to the user. In this library every module has one main address which can be used for auto acknowledge communication and the broadcast address \texttt{0xFF}.
   
   After initializing the radio module the module is in receiving mode. Thus it will receive packets to its own address or the broadcast address \texttt{0xFF}. The initializing is done with through the function \texttt{DLL\_init} where you need to set the address, auto retransmission count, RF channel and the air data rate.
   
   For sending a packet call the \texttt{DLL\_send} function with the send type, either ask for ACK or does not ask for ACK, receiver address, data and the length of data. The maximum length of one packet is 32 Byte.
   
   To receive a packet call the function \texttt{DLL\_receive}, which returns \texttt{0} if there is not received data in the FIFO. To avoid polling this function, there is a variable called \texttt{DLL\_irq\_rx\_counter} which indicated that the radio module received a packet. This variable is set in an interrupt from the radio module.
   
     \section{Power electronics}
     The project utilizes 230 Volt direct from a standard power socket. In order to handle this potential risk of electric shock as safe as possible we chose to use an optocoupler and a triac for the dimming effect and a 










\end{document}
